% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/tool-agent-custom.R
\name{btw_agent_tool}
\alias{btw_agent_tool}
\title{Create a custom agent tool from a markdown file}
\usage{
btw_agent_tool(path, client = NULL)
}
\arguments{
\item{path}{Path to an agent markdown file.}

\item{client}{Optional. A client specification to override the agent's
configured client. Can be a string like
\code{"anthropic/claude-sonnet-4-20250514"}, an \link[ellmer:Chat]{ellmer::Chat} object, or a list
with \code{provider} and \code{model} keys. If \code{NULL} (default), uses the \code{client}
field from the agent file or falls back to btw's default client resolution.}
}
\value{
An \code{ellmer::ToolDef} object that can be registered with a chat
client, or \code{NULL} if the file is invalid (with a warning).
}
\description{
Creates an \code{\link[ellmer:tool]{ellmer::tool()}} from a markdown file that defines a custom agent.
The tool can be registered with a chat client to delegate tasks to a
specialized assistant with its own system prompt and tool configuration.
\subsection{Agent File Format}{

Agent files use YAML frontmatter to configure the agent, with the markdown
body becoming the agent's system prompt. The file should be named
\verb{agent-\{name\}.md}.
\subsection{Required Fields}{
\itemize{
\item \code{name}: A valid R identifier (letters, numbers, underscores) that becomes
part of the tool name: \verb{btw_tool_agent_\{name\}}. The final name cannot
conflict with any existing \code{\link[=btw_tools]{btw_tools()}} names.
}
}

\subsection{Optional Fields}{
\itemize{
\item \code{description}: Tool description shown to the LLM. Defaults to a generic
delegation message.
\item \code{title}: User-facing title for the tool. Defaults to title-cased name.
\item \code{icon}: Icon specification for the agent (see \strong{Icon Specification}
below). Defaults to the standard agent icon.
\item \code{client}: Model specification like \code{"anthropic/claude-sonnet-4-20250514"}.
Falls back to \code{btw.subagent.client} or \code{btw.client} options.
\item \code{tools}: List of tool names or groups available to this agent. Defaults to
all non-agent tools.
}
}

\subsection{Icon Specification}{

The \code{icon} field supports three formats:
\enumerate{
\item \strong{Plain icon name}: Uses \code{shiny::icon()} (Font Awesome icons). Example:
\code{icon: robot} or \code{icon: code}
\item \strong{Raw SVG}: Starts with \verb{<svg} and is used literally. Example:
\code{icon: '<svg viewBox="0 0 24 24">...</svg>'}
\item \strong{Package-prefixed icon}: Uses \code{pkg::icon-name} format to specify icons
from other icon packages. Supported packages:\tabular{lll}{
   Package \tab Syntax \tab Function Called \cr
   fontawesome \tab \code{fontawesome::home} \tab \code{\link[fontawesome:fa]{fontawesome::fa()}} \cr
   bsicons \tab \code{bsicons::house} \tab \code{\link[bsicons:bs_icon]{bsicons::bs_icon()}} \cr
   phosphoricons \tab \code{phosphoricons::house} \tab \code{\link[phosphoricons:ph]{phosphoricons::ph()}} \cr
   rheroicons \tab \code{rheroicons::home} \tab \code{\link[rheroicons:rheroicon]{rheroicons::rheroicon()}} \cr
   tabler \tab \code{tabler::home} \tab \code{\link[tabler:tabler-components]{tabler::icon()}} \cr
   shiny \tab \code{shiny::home} \tab \code{\link[shiny:icon]{shiny::icon()}} \cr
}


The specified package must be installed. If the package is missing or the
icon name is invalid, a warning is issued and the default agent icon is
used.
}
}

\subsection{Example Agent File}{

\if{html}{\out{<div class="sourceCode yaml">}}\preformatted{---
name: code_reviewer
description: Reviews code for best practices and potential issues.
title: Code Reviewer
icon: magnifying-glass
tools:
  - files
  - docs
---

You are a code reviewer. Analyze code for:
- Best practices and style
- Potential bugs or issues
- Performance considerations

Provide specific, actionable feedback.
}\if{html}{\out{</div>}}
}

}

\subsection{Automatic Discovery}{

Agent files are automatically discovered by \code{\link[=btw_tools]{btw_tools()}} when placed in
the following locations (in order of priority):
\itemize{
\item \strong{Project level (btw)}: \verb{.btw/agent-*.md} in your project directory
\item \strong{User level (btw)}: \verb{~/.btw/agent-*.md} or \verb{~/.config/btw/agent-*.md}
\item \strong{Project level (Claude Code)}: \verb{.claude/agents/*.md} in your project directory
\item \strong{User level (Claude Code)}: \verb{~/.claude/agents/*.md}
}

btw-style agents take precedence over Claude Code agents with the same name.
When duplicate agent names are found, a warning is issued.
}

\subsection{Claude Code Compatibility}{

btw supports loading agent files from Claude Code's \verb{.claude/agents/}
directory for compatibility. However, there are some small differences
when Claude Code agents are used in btw:
\itemize{
\item \strong{Name normalization}: Agent names with hyphens (e.g., \code{code-reviewer})
are automatically converted to underscores (\code{code_reviewer}) for R
compatibility.
\item \strong{Ignored fields}: The following Claude Code fields are ignored (with
a warning): \code{model}, \code{tools}, \code{permissionMode}, \code{skills}. Use btw's
\code{client} field instead of \code{model}, and btw agents use default tools.
\item \strong{\code{client} argument}: Use the \code{client} argument to manually override
the model for any agent file.
}
}
}
\examples{
# Create a btw-style agent file
withr::with_tempdir({
  dir.create(".btw")
  writeLines(
    c(
      "---",
      "name: code_reviewer",
      "description: Reviews code for best practices.",
      "---",
      "",
      "You are a code reviewer. Analyze code for best practices."
    ),
    ".btw/agent-code_reviewer.md"
  )

  tool <- btw_agent_tool(".btw/agent-code_reviewer.md")
  # Use `chat$register_tool(tool)` to register with an ellmer chat client

  tool
})

# Create a Claude Code-style agent file (name with hyphens)
withr::with_tempdir({
  dir.create(".claude/agents", recursive = TRUE)
  writeLines(
    c(
      "---",
      "name: test-helper",
      "description: Helps write tests.",
      "model: sonnet",
      "---",
      "",
      "You help write tests for R code."
    ),
    ".claude/agents/test-helper.md"
  )

  tool <- btw_agent_tool(".claude/agents/test-helper.md")
  # Use `chat$register_tool(tool)` to register with an ellmer chat client

  tool
})

}
\seealso{
\code{\link[=btw_tools]{btw_tools()}} for automatic agent discovery, \code{\link[=btw_client]{btw_client()}} for
creating chat clients with tools.
}
