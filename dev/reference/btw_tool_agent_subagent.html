<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Tool: Subagent — btw_tool_agent_subagent • btw</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Tool: Subagent — btw_tool_agent_subagent"><meta name="description" content="btw_tool_agent_subagent() is a btw tool that enables hierarchical agent
workflows. When used by an LLM assistant (like btw_app(), btw_client(),
or third-party tools like Claude Code), this tool allows the orchestrating
agent to delegate complex tasks to specialized subagents, each with their own
isolated conversation thread and tool access.
This function is primarily intended to be called by LLM assistants via tool
use, not directly by end users.
How Subagents Work


When an LLM calls this tool:
A new chat session is created (or an existing one is resumed)
The subagent receives the prompt and begins working with only the tools
specified in the tools parameter
The subagent works independently, making tool calls until it completes
the task
The function returns the subagent's final message text and a session_id
The orchestrating agent can resume the session later by providing the
session_id


Each subagent maintains its own conversation context, separate from the
orchestrating agent's context. Subagent sessions persist for the duration of
the R session.



Tool Access


The orchestrating agent must specify which tools the subagent can use via
the tools parameter. The subagent is restricted to only these tools - it
cannot access tools from the parent session. Tools can be specified by:
Specific tool names: c(&quot;btw_tool_files_read_text_file&quot;, &quot;btw_tool_files_write_text_file&quot;)
Tool groups: &quot;files&quot; includes all file-related tools
NULL (default): Uses the default tool set from options or
btw_tools()





Configuration Options


Subagent behavior can be configured via R options:
btw.subagent.client: The ellmer::Chat client or provider/model string
to use for subagents. If not set, falls back to btw.client, then to the
default Anthropic client.
btw.subagent.tools_default: Default tools to provide to subagents when
the orchestrating agent doesn't specify tools via the tools parameter.
If not set, falls back to btw.tools, then all btw tools from
btw_tools(). This is a convenience option for setting reasonable
defaults.
btw.subagent.tools_allowed: An allowlist of tools that subagents are
allowed to use at all. When set, any tools requested (either explicitly via
the tools parameter or from defaults) will be filtered against this list.
If disallowed tools are requested, an error is thrown. This provides a
security boundary to restrict subagent capabilities. If not set, all
btw_tools() are allowed.


These options follow the precedence: function argument &amp;gt; btw.subagent.*
option &amp;gt; btw.* option &amp;gt; default value. The tools_allowed option acts as a
filter on top of the resolved tools, regardless of their source.

"><meta property="og:description" content="btw_tool_agent_subagent() is a btw tool that enables hierarchical agent
workflows. When used by an LLM assistant (like btw_app(), btw_client(),
or third-party tools like Claude Code), this tool allows the orchestrating
agent to delegate complex tasks to specialized subagents, each with their own
isolated conversation thread and tool access.
This function is primarily intended to be called by LLM assistants via tool
use, not directly by end users.
How Subagents Work


When an LLM calls this tool:
A new chat session is created (or an existing one is resumed)
The subagent receives the prompt and begins working with only the tools
specified in the tools parameter
The subagent works independently, making tool calls until it completes
the task
The function returns the subagent's final message text and a session_id
The orchestrating agent can resume the session later by providing the
session_id


Each subagent maintains its own conversation context, separate from the
orchestrating agent's context. Subagent sessions persist for the duration of
the R session.



Tool Access


The orchestrating agent must specify which tools the subagent can use via
the tools parameter. The subagent is restricted to only these tools - it
cannot access tools from the parent session. Tools can be specified by:
Specific tool names: c(&quot;btw_tool_files_read_text_file&quot;, &quot;btw_tool_files_write_text_file&quot;)
Tool groups: &quot;files&quot; includes all file-related tools
NULL (default): Uses the default tool set from options or
btw_tools()





Configuration Options


Subagent behavior can be configured via R options:
btw.subagent.client: The ellmer::Chat client or provider/model string
to use for subagents. If not set, falls back to btw.client, then to the
default Anthropic client.
btw.subagent.tools_default: Default tools to provide to subagents when
the orchestrating agent doesn't specify tools via the tools parameter.
If not set, falls back to btw.tools, then all btw tools from
btw_tools(). This is a convenience option for setting reasonable
defaults.
btw.subagent.tools_allowed: An allowlist of tools that subagents are
allowed to use at all. When set, any tools requested (either explicitly via
the tools parameter or from defaults) will be filtered against this list.
If disallowed tools are requested, an error is thrown. This provides a
security boundary to restrict subagent capabilities. If not set, all
btw_tools() are allowed.


These options follow the precedence: function argument &amp;gt; btw.subagent.*
option &amp;gt; btw.* option &amp;gt; default value. The tools_allowed option acts as a
filter on top of the resolved tools, regardless of their source.

"><meta property="og:image" content="https://posit-dev.github.io/btw/logo.png"><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">btw</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/posit-dev/btw/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Tool: Subagent</h1>
      <small class="dont-index">Source: <a href="https://github.com/posit-dev/btw/blob/main/R/tool-agent-subagent.R" class="external-link"><code>R/tool-agent-subagent.R</code></a></small>
      <div class="d-none name"><code>btw_tool_agent_subagent.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>btw_tool_agent_subagent()</code> is a btw tool that enables hierarchical agent
workflows. When used by an LLM assistant (like <code><a href="btw_client.html">btw_app()</a></code>, <code><a href="btw_client.html">btw_client()</a></code>,
or third-party tools like Claude Code), this tool allows the orchestrating
agent to delegate complex tasks to specialized subagents, each with their own
isolated conversation thread and tool access.</p>
<p>This function is primarily intended to be called by LLM assistants via tool
use, not directly by end users.</p><div class="section">
<h3 id="how-subagents-work">How Subagents Work<a class="anchor" aria-label="anchor" href="#how-subagents-work"></a></h3>


<p>When an LLM calls this tool:</p><ol><li><p>A new chat session is created (or an existing one is resumed)</p></li>
<li><p>The subagent receives the <code>prompt</code> and begins working with only the tools
specified in the <code>tools</code> parameter</p></li>
<li><p>The subagent works independently, making tool calls until it completes
the task</p></li>
<li><p>The function returns the subagent's final message text and a <code>session_id</code></p></li>
<li><p>The orchestrating agent can resume the session later by providing the
<code>session_id</code></p></li>
</ol><p>Each subagent maintains its own conversation context, separate from the
orchestrating agent's context. Subagent sessions persist for the duration of
the R session.</p>
</div>

<div class="section">
<h3 id="tool-access">Tool Access<a class="anchor" aria-label="anchor" href="#tool-access"></a></h3>


<p>The orchestrating agent must specify which tools the subagent can use via
the <code>tools</code> parameter. The subagent is restricted to only these tools - it
cannot access tools from the parent session. Tools can be specified by:</p><ul><li><p><strong>Specific tool names</strong>: <code>c("btw_tool_files_read_text_file", "btw_tool_files_write_text_file")</code></p></li>
<li><p><strong>Tool groups</strong>: <code>"files"</code> includes all file-related tools</p></li>
<li><p><strong>NULL</strong> (default): Uses the default tool set from options or
<code><a href="btw_tools.html">btw_tools()</a></code></p></li>
</ul></div>

<div class="section">
<h3 id="configuration-options">Configuration Options<a class="anchor" aria-label="anchor" href="#configuration-options"></a></h3>


<p>Subagent behavior can be configured via R options:</p><ul><li><p><code>btw.subagent.client</code>: The ellmer::Chat client or <code>provider/model</code> string
to use for subagents. If not set, falls back to <code>btw.client</code>, then to the
default Anthropic client.</p></li>
<li><p><code>btw.subagent.tools_default</code>: Default tools to provide to subagents when
the orchestrating agent doesn't specify tools via the <code>tools</code> parameter.
If not set, falls back to <code>btw.tools</code>, then all btw tools from
<code><a href="btw_tools.html">btw_tools()</a></code>. This is a convenience option for setting reasonable
defaults.</p></li>
<li><p><code>btw.subagent.tools_allowed</code>: An allowlist of tools that subagents are
allowed to use at all. When set, any tools requested (either explicitly via
the <code>tools</code> parameter or from defaults) will be filtered against this list.
If disallowed tools are requested, an error is thrown. This provides a
security boundary to restrict subagent capabilities. If not set, all
<code><a href="btw_tools.html">btw_tools()</a></code> are allowed.</p></li>
</ul><p>These options follow the precedence: function argument &gt; <code>btw.subagent.*</code>
option &gt; <code>btw.*</code> option &gt; default value. The <code>tools_allowed</code> option acts as a
filter on top of the resolved tools, regardless of their source.</p>
</div>

    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">btw_tool_agent_subagent</span><span class="op">(</span></span>
<span>  <span class="va">prompt</span>,</span>
<span>  tools <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  session_id <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  `_intent` <span class="op">=</span> <span class="st">""</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-prompt">prompt<a class="anchor" aria-label="anchor" href="#arg-prompt"></a></dt>
<dd><p>Character string with the task description for the subagent.
The subagent will work on this task using only the tools specified in
<code>tools</code>. The subagent does not have access to the orchestrating agent's
conversation history.</p></dd>


<dt id="arg-tools">tools<a class="anchor" aria-label="anchor" href="#arg-tools"></a></dt>
<dd><p>Optional character vector of tool names or tool groups that the
subagent is allowed to use. Can be specific tool names (e.g.,
<code>"btw_tool_files_read_text_file"</code>), tool group names (e.g., <code>"files"</code>), or
<code>NULL</code> to use the default tools from <code>btw.subagent.tools_default</code>,
<code>btw.tools</code>, or <code><a href="btw_tools.html">btw_tools()</a></code>.</p></dd>


<dt id="arg-session-id">session_id<a class="anchor" aria-label="anchor" href="#arg-session-id"></a></dt>
<dd><p>Optional character string with a session ID from a
previous call. When provided, resumes the existing subagent conversation
instead of starting a new one. Session IDs are returned in the result and
have the format "adjective_noun" (e.g., "swift_falcon").</p></dd>


<dt id="arg--intent">_intent<a class="anchor" aria-label="anchor" href="#arg--intent"></a></dt>
<dd><p>Optional string describing the intent of the tool call. Added
automatically by the ellmer framework when tools are called by LLMs.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code>BtwSubagentResult</code> object (inherits from <code>BtwToolResult</code>) with:</p><ul><li><p><code>value</code>: The final message text from the subagent</p></li>
<li><p><code>session_id</code>: The session identifier for resuming this conversation</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="btw_tools.html">btw_tools()</a></code> for available tools and tool groups</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># This tool is typically called by LLMs via tool use, not directly.</span></span></span>
<span class="r-in"><span><span class="co"># The examples below show how to configure subagent behavior.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Configure the client and default tools for subagents</span></span></span>
<span class="r-in"><span><span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_options.html" class="external-link">with_options</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    btw.subagent.client <span class="op">=</span> <span class="st">"anthropic/claude-sonnet-4-20250514"</span>,</span></span>
<span class="r-in"><span>    btw.subagent.tools_default <span class="op">=</span> <span class="st">"files"</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"btw.subagent.client"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "anthropic/claude-sonnet-4-20250514"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Restrict subagents to only certain tools</span></span></span>
<span class="r-in"><span><span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_options.html" class="external-link">with_options</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    btw.subagent.tools_allowed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"files"</span>, <span class="st">"docs"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    btw.subagent.tools_default <span class="op">=</span> <span class="st">"files"</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"btw.subagent.tools_allowed"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "files" "docs" </span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://garrickadenbuie.com" class="external-link">Garrick Aden-Buie</a>, <a href="https://www.simonpcouch.com/" class="external-link">Simon Couch</a>, Joe Cheng, Posit Software, PBC.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

