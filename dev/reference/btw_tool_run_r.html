<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Tool: Run R code — btw_tool_run_r • btw</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Tool: Run R code — btw_tool_run_r"><meta name="description" content="
This tool runs R code and returns results as a list of ellmer::Content()
objects. It captures text output, plots, messages, warnings, and errors. Code
execution stops on the first error, returning all results up to that point."><meta property="og:description" content="
This tool runs R code and returns results as a list of ellmer::Content()
objects. It captures text output, plots, messages, warnings, and errors. Code
execution stops on the first error, returning all results up to that point."><meta property="og:image" content="https://posit-dev.github.io/btw/logo.png"><meta name="robots" content="noindex"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">btw</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/posit-dev/btw/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Tool: Run R code</h1>
      <small class="dont-index">Source: <a href="https://github.com/posit-dev/btw/blob/main/R/tool-run.R" class="external-link"><code>R/tool-run.R</code></a></small>
      <div class="d-none name"><code>btw_tool_run_r.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="figures/lifecycle-experimental.svg" alt="[Experimental]"></a>
This tool runs R code and returns results as a list of <code><a href="https://ellmer.tidyverse.org/reference/Content.html" class="external-link">ellmer::Content()</a></code>
objects. It captures text output, plots, messages, warnings, and errors. Code
execution stops on the first error, returning all results up to that point.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">btw_tool_run_r</span><span class="op">(</span><span class="va">code</span>, `_intent` <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-code">code<a class="anchor" aria-label="anchor" href="#arg-code"></a></dt>
<dd><p>A character string containing R code to run.</p></dd>


<dt id="arg--intent">_intent<a class="anchor" aria-label="anchor" href="#arg--intent"></a></dt>
<dd><p>Intent description (automatically added by ellmer).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list of ellmer Content objects:</p><ul><li><p><code>ContentText</code>: visible return values and text output</p></li>
<li><p><code>ContentMessage</code>: messages from <code><a href="https://rdrr.io/r/base/message.html" class="external-link">message()</a></code></p></li>
<li><p><code>ContentWarning</code>: warnings from <code><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning()</a></code></p></li>
<li><p><code>ContentError</code>: errors from <code><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop()</a></code></p></li>
<li><p><code>ContentImageInline</code>: plots created during execution</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>

<div class="section">
<h3 id="configuration-options">Configuration Options<a class="anchor" aria-label="anchor" href="#configuration-options"></a></h3>


<p>The behavior of the <code>btw_tool_run_r</code> tool can be customized using the
following R options:</p><ul><li><p><code>btw.run_r.graphics_device</code>: A function that creates a graphics device used
for rendering plots. By default, it uses <code><a href="https://ragg.r-lib.org/reference/agg_png.html" class="external-link">ragg::agg_png()</a></code> if the <code>ragg</code>
package is installed, otherwise it falls back to <code><a href="https://rdrr.io/r/grDevices/png.html" class="external-link">grDevices::png()</a></code>.</p></li>
<li><p><code>btw.run_r.plot_aspect_ratio</code>: Aspect ratio for plots created during code
execution. Can be a character string of the form <code>"w:h"</code> (e.g., <code>"16:9"</code>)
or a numeric value representing width/height (e.g., <code>16/9</code>). Default is
<code>"3:2"</code>.</p></li>
<li><p><code>btw.run_r.plot_size</code>: Integer pixel size for the longest side of plots.
Default is <code>768L</code>. This image size was selected to match <a href="https://platform.openai.com/docs/guides/images-vision?api-mode=responses" class="external-link">OpenAI's image resizing rules</a>,
where images are resized such that the largest size is 768px. Another
common choice is 512px. Larger images may be used but will result in
increased token sizes.</p></li>
<li><p><code>btw.run_r.enabled</code>: Logical flag to enable or disable the tool globally.</p></li>
</ul><p>These values can be set using <code><a href="https://rdrr.io/r/base/options.html" class="external-link">options()</a></code> in your R session or <code>.Rprofile</code> or
in a <a href="use_btw_md.html">btw.md file</a> under the <code>options</code> section.</p>
<p></p><div class="sourceCode md"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="an">options:</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="co"> run_r:</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co">   enabled: true</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="co">   plot_aspect_ratio: "16:9"</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="co">   plot_size: 512</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co">---</span></span></code></pre><p></p></div>
</div>

    </div>
    <div class="section level2">
    <h2 id="security-considerations">Security Considerations<a class="anchor" aria-label="anchor" href="#security-considerations"></a></h2>


<p>Executing arbitrary R code can pose significant security risks, especially
in shared or multi-user environments. Furthermore, neither <span class="pkg">shinychat</span>
(as of v0.4.0) or nor <span class="pkg">ellmer</span> (as of v0.4.0) provide a mechanism to
review and reject the code before execution. Even more, the code is executed
in the global environment and does not have any sandboxing or R code
limitations applied.</p>
<p>It is your responsibility to ensure that you are taking appropriate measures
to reduce the risk of the LLM writing arbitrary code. Most often, this means
not prompting the model to take large or potentially destructive actions.
At this time, we do not recommend that you enable this tool in a publicly-
available environment without strong safeguards in place.</p>
<p>That said, this tool is very powerful and can greatly enhance the
capabilities of your btw chatbots. Please use it responsibly! If you'd like
to enable the tool, please read the instructions below.</p>
    </div>
    <div class="section level2">
    <h2 id="enabling-this-tool">Enabling this tool<a class="anchor" aria-label="anchor" href="#enabling-this-tool"></a></h2>


<p>This tool is not enabled by default in <code><a href="btw_tools.html">btw_tools()</a></code>, <code><a href="btw_client.html">btw_app()</a></code> or
<code><a href="btw_client.html">btw_client()</a></code>. To enable the function, you have a few options:</p><ol><li><p>Set the <code>btw.run_r.enabled</code> option to <code>TRUE</code> in your R session, or in your
<code>.Rprofile</code> file to enable it globally.</p></li>
<li><p>Set the <code>BTW_RUN_R_ENABLED</code> environment variable to <code>true</code> in your
<code>.Renviron</code> file or your system environment.</p></li>
<li><p>Explicitly include the tool when calling <code>btw_tools("run")</code> (unless the
above options disable it).</p></li>
</ol><p>In your <a href="use_btw_md.html">btw.md file</a>, you can explicitly enable the tool by
naming it in the tools option</p>
<p></p><div class="sourceCode md"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="an">tools:</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="co">  - run_r</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co">---</span></span></code></pre><p></p></div>
<p>or you can enable the tool by setting the <code>btw.run_r.enabled</code> option from the
<code>options</code> list in <code>btw.md</code> (this approach is useful if you've globally
disabled the tool but want to enable it for a specific btw chat):</p>
<p></p><div class="sourceCode md"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="an">options:</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="co">  run_r:</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co">    enabled: true</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="co">---</span></span></code></pre><p></p></div>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="btw_tools.html">btw_tools()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Simple calculation</span></span></span>
<span class="r-in"><span><span class="fu">btw_tool_run_r</span><span class="op">(</span><span class="st">"2 + 2"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Code with plot</span></span></span>
<span class="r-in"><span><span class="fu">btw_tool_run_r</span><span class="op">(</span><span class="st">"hist(rnorm(100))"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Code with warning</span></span></span>
<span class="r-in"><span><span class="fu">btw_tool_run_r</span><span class="op">(</span><span class="st">"mean(c(1, 2, NA))"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://garrickadenbuie.com" class="external-link">Garrick Aden-Buie</a>, <a href="https://www.simonpcouch.com/" class="external-link">Simon Couch</a>, Joe Cheng, Posit Software, PBC.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

